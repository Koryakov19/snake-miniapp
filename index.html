<body style="margin:0; background:#111;">

<!-- Поле -->
<canvas id="game" width="400" height="400" 
        style="background:#000; display:block; margin:20px auto; border:3px solid #fff;"></canvas>

<!-- Уровень -->
<div id="lvl" style="text-align:center; color:white; font-size:22px;">
    Уровень: 1
</div>

<!-- КНОПКИ УПРАВЛЕНИЯ -->
<div style="text-align:center; margin-top:20px; user-select:none;">

    <div>
        <button id="btnUp" class="btn">▲</button>
    </div>

    <div>
        <button id="btnLeft" class="btn">◀</button>
        <button id="btnDown" class="btn">▼</button>
        <button id="btnRight" class="btn">▶</button>
    </div>

</div>

<style>
    .btn {
        width: 80px;
        height: 80px;
        font-size: 36px;
        margin: 10px;
        border-radius: 12px;
        background:#222;
        color:white;
        border:2px solid #555;
    }
    .btn:active {
        background:#444;
    }
</style>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const lvlDiv = document.getElementById("lvl");

    const size = 20;
    let snake = [{x: 200, y: 200}];
    let dx = size;
    let dy = 0;

    let food = genFood();
    let level = 1;
    let speed = 200;
    let timer;

    document.addEventListener("keydown", key);

    // Кнопки управления
    document.getElementById("btnUp").onclick = () => move(0, -size);
    document.getElementById("btnDown").onclick = () => move(0, size);
    document.getElementById("btnLeft").onclick = () => move(-size, 0);
    document.getElementById("btnRight").onclick = () => move(size, 0);

    function move(nx, ny) {
        if ((nx !== 0 && dx === 0) || (ny !== 0 && dy === 0)) {
            dx = nx;
            dy = ny;
        }
    }

    start();

    function start() {
        timer = setInterval(game, speed);
    }

    function game() {
        let head = { x: snake[0].x + dx, y: snake[0].y + dy };

        if (head.x < 0 || head.x >= 400 || head.y < 0 || head.y >= 400) {
            lose();
            return;
        }

        for (let i = 0; i < snake.length; i++) {
            if (snake[i].x === head.x && snake[i].y === head.y) {
                lose();
                return;
            }
        }

        snake.unshift(head);

        if (head.x === food.x && head.y === food.y) {
            food = genFood();
            level++;
            lvlDiv.textContent = "Уровень: " + level;

            clearInterval(timer);
            speed = Math.max(60, speed - 15);
            timer = setInterval(game, speed);
        } else {
            snake.pop();
        }

        draw();
    }

    function draw() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, 400, 400);

        ctx.fillStyle = "red";
        ctx.fillRect(food.x, food.y, size, size);

        ctx.fillStyle = "lime";
        snake.forEach(s => ctx.fillRect(s.x, s.y, size - 1, size - 1));
    }

    function key(e) {
        if (e.key === "ArrowUp") move(0, -size);
        if (e.key === "ArrowDown") move(0, size);
        if (e.key === "ArrowLeft") move(-size, 0);
        if (e.key === "ArrowRight") move(size, 0);
    }

    function genFood() {
        return {
            x: Math.floor(Math.random() * 20) * size,
            y: Math.floor(Math.random() * 20) * size
        };
    }

    function lose() {
        clearInterval(timer);
        alert("Вы проиграли! Ваш уровень: " + level);
        location.reload();
    }
</script>

</body>
